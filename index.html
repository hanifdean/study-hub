<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Hub ‚Äî Hanif & Sasya</title>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

  :root {
    --bg: #0f0f14;
    --surface: #1a1a24;
    --surface-hover: #1e1e2a;
    --border: #2a2a35;
    --text: #e8e4de;
    --text-muted: #8a8578;
    --accent: #5ec4b6;
    --accent-glow: rgba(94, 196, 182, 0.12);
    --tag-bg: #1a2f2d;
    --tag-text: #5ec4b6;
    --card-shadow: 0 2px 12px rgba(0,0,0,0.3);
    --divider: #22222e;
    --search-bg: #14141c;
    --star-color: #f59e0b;
    --fav-bg: rgba(245, 158, 11, 0.06);
    --fav-border: rgba(245, 158, 11, 0.25);
  }

  [data-theme="light"] {
    --bg: #f8f6f2;
    --surface: #ffffff;
    --surface-hover: #faf8f5;
    --border: #e5e0d8;
    --text: #2c2a26;
    --text-muted: #7a7570;
    --accent: #1a8a7d;
    --accent-glow: rgba(26, 138, 125, 0.06);
    --tag-bg: #e6f3f1;
    --tag-text: #15756a;
    --card-shadow: 0 2px 12px rgba(0,0,0,0.06);
    --divider: #e5e0d8;
    --search-bg: #f0ede8;
    --star-color: #d97706;
    --fav-bg: rgba(217, 119, 6, 0.04);
    --fav-border: rgba(217, 119, 6, 0.2);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    transition: background 0.3s ease, color 0.3s ease;
  }

  .container {
    max-width: 720px;
    margin: 0 auto;
    padding: 2.5rem 1.25rem 4rem;
  }

  /* Header */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
  }
  .header-left h1 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 0.25rem;
  }
  .header-left p {
    font-size: 0.85rem;
    color: var(--text-muted);
  }
  #page-count { font-weight: 600; }
  .link-btn {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    padding: 0;
  }
  .link-btn:hover { color: var(--accent); }

  /* Theme toggle */
  .theme-toggle {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    color: var(--text-muted);
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    flex-shrink: 0;
  }
  .theme-toggle:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  /* Search */
  .search-wrap {
    position: relative;
    margin-bottom: 1rem;
  }
  .search-wrap input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    border-radius: 12px;
    border: 1.5px solid var(--border);
    background: var(--search-bg);
    color: var(--text);
    font-size: 0.9rem;
    font-family: inherit;
    outline: none;
    transition: border-color 0.2s;
  }
  .search-wrap input::placeholder { color: var(--text-muted); }
  .search-wrap input:focus { border-color: var(--accent); }
  .search-wrap .search-icon {
    position: absolute;
    left: 0.85rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.95rem;
    color: var(--text-muted);
    pointer-events: none;
  }

  /* Controls row */
  .controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }
  .sort-select {
    padding: 0.4rem 0.7rem;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    color: var(--text-muted);
    font-size: 0.75rem;
    font-family: inherit;
    font-weight: 600;
    cursor: pointer;
    outline: none;
    transition: border-color 0.2s;
  }
  .sort-select:focus { border-color: var(--accent); }

  /* Tag filter dropdown */
  .tag-filter-wrap {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
    margin-bottom: 1.25rem;
  }
  .tag-filter-row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }
  .tag-select {
    position: relative;
    flex: 1;
    min-width: 220px;
  }
  .tag-select-trigger {
    width: 100%;
    padding: 0.6rem 0.8rem;
    border-radius: 10px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    color: var(--text-muted);
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    font-family: inherit;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    transition: border-color 0.2s ease, color 0.2s ease;
  }
  .tag-select-trigger.active {
    color: var(--text);
    border-color: var(--accent);
  }
  .tag-select-caret {
    color: var(--text-muted);
    font-size: 0.7rem;
  }
  .tag-select.open .tag-select-caret {
    color: var(--accent);
  }
  .tag-select-menu {
    position: absolute;
    top: calc(100% + 0.4rem);
    left: 0;
    right: 0;
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    box-shadow: var(--card-shadow);
    padding: 0.4rem;
    max-height: 220px;
    overflow: auto;
    display: none;
    z-index: 20;
  }
  .tag-select.open .tag-select-menu {
    display: block;
  }
  .tag-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.45rem 0.5rem;
    border-radius: 8px;
    font-size: 0.75rem;
    color: var(--text);
    cursor: pointer;
    transition: background 0.2s ease;
  }
  .tag-option:hover {
    background: var(--surface-hover);
  }
  .tag-option input {
    accent-color: var(--accent);
  }
  .unread-toggle {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-muted);
    border: 1.5px solid var(--border);
    background: var(--surface);
    padding: 0.45rem 0.65rem;
    border-radius: 10px;
    cursor: pointer;
    transition: border-color 0.2s ease, color 0.2s ease, background 0.2s ease;
  }
  .unread-toggle input {
    margin: 0;
    accent-color: var(--accent);
  }
  .unread-toggle.active {
    color: var(--accent);
    border-color: var(--accent);
    background: var(--tag-bg);
  }
  .tag-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 0.35rem;
  }
  .tag-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.2rem 0.55rem;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: var(--tag-bg);
    color: var(--tag-text);
    font-size: 0.7rem;
    font-weight: 600;
  }
  .tag-chip button {
    border: none;
    background: none;
    color: inherit;
    cursor: pointer;
    font-size: 0.8rem;
    line-height: 1;
    padding: 0;
  }

  /* Tabs */
  .tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
  }
  .tab {
    flex: 1;
    padding: 0.7rem 1rem;
    border-radius: 12px;
    border: 1.5px solid var(--border);
    background: transparent;
    color: var(--text-muted);
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.25s ease;
    font-family: inherit;
    text-align: center;
  }
  .tab.active {
    background: var(--accent);
    color: var(--bg);
    border-color: var(--accent);
  }
  .tab:hover:not(.active) {
    border-color: var(--accent);
    color: var(--accent);
  }

  /* Favorites section */
  .favorites-section {
    margin-bottom: 1.75rem;
    display: none;
  }
  .favorites-section.visible { display: block; }
  .favorites-section .section-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--star-color);
    margin-bottom: 0.75rem;
    padding-left: 0.25rem;
  }

  /* Course group */
  .course-group {
    margin-bottom: 1.75rem;
  }
  .course-group-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    margin-bottom: 0.75rem;
    padding-left: 0.25rem;
    user-select: none;
  }
  .course-group-header:hover .course-group-title { color: var(--accent); }
  .course-group-title {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    transition: color 0.2s;
  }
  .group-count {
    font-size: 0.65rem;
    font-weight: 700;
    color: var(--text-muted);
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 0.1rem 0.4rem;
    border-radius: 6px;
  }
  .group-chevron {
    font-size: 0.7rem;
    color: var(--text-muted);
    transition: transform 0.2s;
    margin-left: auto;
  }
  .course-group.collapsed .group-chevron { transform: rotate(-90deg); }
  .course-group.collapsed .group-cards { display: none; }

  /* Cards */
  .card {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 14px;
    padding: 1.1rem 1.25rem;
    margin-bottom: 0.75rem;
    transition: all 0.2s ease;
    text-decoration: none;
    display: block;
    color: inherit;
    position: relative;
  }
  .card:hover {
    border-color: var(--accent);
    background: var(--surface-hover);
    box-shadow: var(--card-shadow);
    transform: translateY(-1px);
  }
  .card-title {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 0.35rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding-right: 2rem;
  }
  .card-title .icon { font-size: 1rem; }
  .unread-dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: var(--accent);
    display: inline-block;
    box-shadow: 0 0 0 2px var(--surface);
  }
  .card-desc {
    font-size: 0.8rem;
    color: var(--text-muted);
    line-height: 1.5;
    margin-bottom: 0.6rem;
  }
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.35rem;
  }
  .tag {
    display: inline-block;
    background: var(--tag-bg);
    color: var(--tag-text);
    padding: 0.15rem 0.55rem;
    border-radius: 6px;
    font-size: 0.7rem;
    font-weight: 600;
  }

  /* Star button */
  .star-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    color: var(--text-muted);
    transition: color 0.2s, transform 0.2s;
    padding: 2px;
    line-height: 1;
  }
  .star-btn:hover { transform: scale(1.2); }
  .star-btn.starred { color: var(--star-color); }

  /* Empty state */
  .empty {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--text-muted);
    font-size: 0.85rem;
  }
  .empty .emoji { font-size: 2rem; margin-bottom: 0.75rem; }

  /* No results */
  .no-results {
    text-align: center;
    padding: 2.5rem 1rem;
    color: var(--text-muted);
    font-size: 0.85rem;
    display: none;
  }

  /* Footer */
  .footer {
    margin-top: 3rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--divider);
    text-align: center;
    font-size: 0.75rem;
    color: var(--text-muted);
  }

  @media (max-width: 480px) {
    .container { padding: 1.5rem 1rem 3rem; }
    .header-left h1 { font-size: 1.25rem; }
    .tab { font-size: 0.8rem; padding: 0.6rem 0.75rem; }
    .tag-filter-row {
      flex-direction: column;
      align-items: stretch;
    }
    .tag-select,
    .unread-toggle {
      width: 100%;
    }
    .unread-toggle {
      justify-content: space-between;
    }
  }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="header-left">
      <h1>üìö Study Hub</h1>
      <p>
        <span id="page-count">24</span> pages, <span id="unread-count">0</span> unread ¬∑
        <button class="link-btn" onclick="markAllRead()">Mark all as read</button> /
        <button class="link-btn" onclick="resetRead()">Reset</button>
        ¬∑ curated by Robin üê±
      </p>
    </div>
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode">
      <span id="theme-icon">üåô</span>
    </button>
  </div>

  <!-- Search -->
  <div class="search-wrap">
    <span class="search-icon">üîç</span>
    <input type="text" id="search-input" placeholder="Search pages... (press / to focus, Esc to clear)" autocomplete="off">
  </div>

  <!-- Controls: sort -->
  <div class="controls">
    <select class="sort-select" id="sort-select">
      <option value="recent">Recently Added</option>
      <option value="unread">Unread First</option>
      <option value="alpha">Alphabetical</option>
      <option value="category">By Category</option>
    </select>
  </div>

  <!-- Tag filters -->
  <div class="tag-filter-wrap">
    <div class="tag-filter-row">
      <div class="tag-select" id="tag-select">
        <button class="tag-select-trigger" id="tag-select-trigger" type="button" aria-haspopup="listbox" aria-expanded="false">
          <span id="tag-select-label">Filter by tag...</span>
          <span class="tag-select-caret">‚ñæ</span>
        </button>
        <div class="tag-select-menu" id="tag-select-menu" role="listbox" aria-label="Filter by tag"></div>
      </div>
      <label class="unread-toggle" id="unread-toggle-label">
        <input type="checkbox" id="unread-toggle">
        <span>Unread only</span>
      </label>
    </div>
    <div class="tag-chips" id="tag-chips"></div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-section="sasya" onclick="switchTab('sasya', this)">‚ú® Sasya's Materials</button>
    <button class="tab" data-section="hanif" onclick="switchTab('hanif', this)">üíª Hanif's Materials</button>
  </div>

  <!-- Favorites -->
  <div class="favorites-section" id="favorites-section">
    <div class="section-label">‚≠ê Favorites</div>
    <div id="favorites-cards"></div>
  </div>

  <!-- Dynamic content -->
  <div id="content-area"></div>

  <!-- No results -->
  <div class="no-results" id="no-results">
    <div class="emoji">üîç</div>
    <p>No pages match your search or filters.</p>
  </div>

  <div class="footer">
    Built with üê± by Robin ‚Äî updated as new materials are added
  </div>
</div>

<script>
// ============================================================
// DATA
// ============================================================
const PAGES = [
  // --- Sasya ---
  {
    id: 'simon-mindmaps',
    title: 'Simon ‚Äî Mind Maps',
    icon: 'üó∫Ô∏è',
    desc: "Two interactive mind maps of Herbert Simon's \"Understanding the Natural and the Artificial Worlds\" ‚Äî Academic Disciplines & Representing Machines.",
    tags: ['Public Management', 'Mind Map'],
    url: 'public-management/simon-mindmaps.html',
    category: 'Public Management',
    categoryIcon: 'üèõÔ∏è',
    section: 'sasya',
    date: '2025-01-15'
  },
  {
    id: 'coupa-case',
    title: 'Coupa ‚Äî Venture Growth & IPO Strategy',
    icon: 'üí∞',
    desc: 'POC framework, cash flow drivers, sales rep IRR, organic vs aggressive growth, valuation at different scenarios.',
    url: 'finance/coupa-case-study.html',
    tags: ['Finance', 'Case Study'],
    category: 'Entrepreneurial Finance',
    categoryIcon: 'üí∞',
    section: 'sasya',
    date: '2026-02-01'
  },
  {
    id: 'broken-promise',
    title: 'The Broken Promise ‚Äî Companies Staying Private Too Long',
    icon: 'üîí',
    desc: 'Citrini\'s argument: companies staying private breaks the social contract. Neo-feudalism, accredited investor gates, $7.7T in unicorns inaccessible to retail.',
    url: 'finance/broken-promise.html',
    tags: ['Finance', 'Deep Dive', 'Case Study'],
    category: 'Investing & Markets',
    categoryIcon: 'üí∞',
    section: 'hanif',
    date: '2026-02-02'
  },
  {
    id: 'polymarket-arbitrage',
    title: 'The Math Needed for Trading on Polymarket',
    icon: 'üìà',
    desc: 'How sophisticated traders extracted $40M in arbitrage using marginal polytopes, Bregman projections, and Frank-Wolfe optimization.',
    url: 'investing/polymarket-arbitrage.html',
    tags: ['Investing', 'Deep Dive', 'Case Study'],
    category: 'Investing & Markets',
    categoryIcon: 'üí∞',
    section: 'hanif',
    date: '2026-02-02'
  },
  {
    id: 'social-biz-week1',
    title: 'Social Business Design ‚Äî Week 1: Introduction',
    icon: 'üèóÔ∏è',
    desc: 'What makes a business social, BOP thesis, institutional voids, Zahra typology, hybridity challenges, scaling inhibitors, and the contested role of business.',
    url: 'social-innovation/social-business-design-week1.html',
    tags: ['Social Business Design', 'Week 1', 'Lecture'],
    category: 'Social Innovation & Design',
    categoryIcon: 'üå±',
    section: 'sasya',
    date: '2026-02-05'
  },
  {
    id: 'social-biz-week2',
    title: 'Social Business Design ‚Äî Week 2: Scaling + OLPC Case',
    icon: 'üìà',
    desc: 'Scaling frameworks (5Rs, inhibitors, speed factors), Korten progression, and the OLPC cautionary tale ‚Äî when global ambition meets local reality.',
    url: 'social-innovation/social-business-design-week2.html',
    tags: ['Social Business Design', 'Week 2', 'Case Study'],
    category: 'Social Innovation & Design',
    categoryIcon: 'üå±',
    section: 'sasya',
    date: '2026-02-05',
  },
  {
    id: 'social-biz-week3',
    title: 'Social Business Design ‚Äî Week 3: Scaling Impact & Theory of Change',
    icon: 'üéØ',
    desc: 'Impact measurement, founder intentionality, the Theory of Change framework, attribution challenges, and SSIR\'s scaling strategies.',
    url: 'social-innovation/social-business-design-week3.html',
    tags: ['Social Business Design', 'Week 3', 'Framework'],
    category: 'Social Innovation & Design',
    categoryIcon: 'üå±',
    section: 'sasya',
    date: '2026-02-06',
  },
  {
    id: 'swiperx-case',
    title: 'SwipeRx ‚Äî Scaling vs Mission in Social Enterprise',
    icon: 'üå±',
    desc: 'Zahra typology, Compartamos comparison, when scaling helps vs hurts mission, Apotek Inofarma expansion analysis.',
    url: 'social-innovation/swiperx-case.html',
    tags: ['Social Innovation', 'Case Study'],
    category: 'Social Innovation & Design',
    categoryIcon: 'üå±',
    section: 'sasya',
    date: '2026-01-31'
  },
  {
    id: 'who-pays-overview',
    title: 'Who Pays? ‚Äî 5 Cases in Social Innovation',
    icon: 'üí∏',
    desc: 'Insulin, Compartamos, OneDay Health, SwipeRx, ImpulsoGov ‚Äî who bears the cost when business models collide with social missions. Zahra typology mapping & cross-case analysis.',
    url: 'social-innovation/who-pays-overview.html',
    tags: ['Social Innovation', 'Case Study', 'Summary'],
    category: 'Social Innovation & Design',
    categoryIcon: 'üå±',
    section: 'sasya',
    date: '2026-02-02'
  },
  {
    id: 'scaling-endgames',
    title: 'Scaling Endgames & Ultimate Payor',
    icon: 'üß≠',
    desc: 'The 6 endgames framework, payor mapping, ultimate payor test, pay-for-success loop, and OneDay Health risk analysis.',
    url: 'social-innovation/scaling-endgames.html',
    tags: ['Social Innovation', 'Framework'],
    category: 'Social Innovation & Design',
    categoryIcon: 'üå±',
    section: 'sasya',
    date: '2026-02-03'
  },
  {
    id: 'community-economies-week3',
    title: 'Community Economies & Systems of Exchange',
    icon: 'üåç',
    desc: 'Week 3 readings summary: Biggart & Delbridge on exchange systems, Hossein & Kinyanjui on ROSCAs, arisan, and Global South community economies.',
    url: 'social-innovation/community-economies-week3.html',
    tags: ['Social Innovation', 'Reading Summary', 'Week 3'],
    category: 'Social Innovation & Design',
    categoryIcon: 'üå±',
    section: 'sasya',
    date: '2026-02-06'
  },
  {
    id: 'unit-economics-guide',
    title: 'Unit Economics ‚Äî The Complete Framework',
    icon: 'üìä',
    desc: 'LTV, CAC, payback, Series A benchmarks, Strava vs Robot cash flow timing, and key exam frameworks.',
    url: 'finance/unit-economics-guide.html',
    tags: ['Finance', 'Framework'],
    category: 'Entrepreneurial Finance',
    categoryIcon: 'üí∞',
    section: 'sasya',
    date: '2026-02-03'
  },
  {
    id: 'pm-w3-summaries',
    title: 'Week 3 Readings ‚Äî Kroes, Simon & Lawson',
    icon: 'üìñ',
    desc: 'Dual nature of artefacts, science of the artificial, illusion of explanatory depth. How they connect to public management.',
    url: 'public-management/w3-summaries.html',
    tags: ['Public Management', 'Summary'],
    category: 'Public Management',
    categoryIcon: 'üèõÔ∏è',
    section: 'sasya',
    date: '2026-02-01'
  },
  // --- Hanif: AI Value Chain ---
  {
    id: 'layer1',
    title: 'Layer 1: Raw Materials & Equipment',
    icon: '‚õèÔ∏è',
    desc: 'Rare earths, silicon, copper, lithography machines (ASML), and the geopolitical chokepoints at the base of the stack.',
    tags: ['Semiconductors', 'Deep Dive'],
    url: 'ai-value-chain/layer1-raw-materials.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2025-02-01'
  },
  {
    id: 'layer2',
    title: 'Layer 2: Chip Design',
    icon: 'üß†',
    desc: 'Nvidia, AMD, Broadcom, ARM, Qualcomm ‚Äî GPU architectures, EDA tools, and the fabless model.',
    tags: ['Semiconductors', 'Deep Dive'],
    url: 'ai-value-chain/layer2-chip-design.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2025-02-02'
  },
  {
    id: 'layer3',
    title: 'Layer 3: Foundries & Fabrication',
    icon: 'üè≠',
    desc: 'TSMC, Samsung, Intel ‚Äî process nodes, fab economics, and why manufacturing is the ultimate bottleneck.',
    tags: ['Semiconductors', 'Deep Dive'],
    url: 'ai-value-chain/layer3-foundries.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2025-02-03'
  },
  {
    id: 'layer4-hbm',
    title: 'Layer 4: HBM & Memory',
    icon: 'üíæ',
    desc: 'High Bandwidth Memory ‚Äî SK Hynix, Samsung, Micron. Why HBM is the AI bottleneck and production tradeoffs with consumer DRAM.',
    tags: ['Semiconductors', 'Deep Dive'],
    url: 'ai-value-chain/hbm-memory-layer.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2025-02-04'
  },
  {
    id: 'cowos',
    title: 'CoWoS Advanced Packaging',
    icon: 'üì¶',
    desc: "TSMC's Chip-on-Wafer-on-Substrate ‚Äî the critical step that bonds chips to HBM, and why it's capacity-constrained.",
    tags: ['Semiconductors', 'Deep Dive'],
    url: 'ai-value-chain/cowos-packaging.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2025-02-05'
  },
  {
    id: 'layer5',
    title: 'Layer 5: Systems, Servers & Networking',
    icon: 'üñß',
    desc: 'Server racks, NVLink, InfiniBand ‚Äî how GPUs connect into clusters and the networking stack that makes AI training possible.',
    tags: ['AI Infrastructure', 'Deep Dive'],
    url: 'ai-value-chain/layer5-systems-networking.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2025-02-06'
  },
  {
    id: 'layer6',
    title: 'Layer 6: Energy & Data Centers',
    icon: '‚ö°',
    desc: 'Power demands, cooling, nuclear renaissance ‚Äî the physical infrastructure powering the AI revolution.',
    tags: ['AI Infrastructure', 'Deep Dive'],
    url: 'ai-value-chain/layer6-energy-datacenters.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2025-02-07'
  },
  {
    id: 'layer7',
    title: 'Layer 7: Cloud & Compute Providers',
    icon: '‚òÅÔ∏è',
    desc: 'AWS, Azure, GCP, CoreWeave ‚Äî hyperscalers and GPU cloud economics.',
    tags: ['AI Infrastructure', 'Deep Dive'],
    url: 'ai-value-chain/layer7-cloud-compute.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2025-02-08'
  },
  {
    id: 'layer8',
    title: 'Layer 8: AI Labs & Software',
    icon: 'ü§ñ',
    desc: 'OpenAI, Anthropic, Google DeepMind, Meta AI ‚Äî the labs building frontier models and the software layer on top.',
    tags: ['AI Infrastructure', 'Deep Dive'],
    url: 'ai-value-chain/layer8-ai-labs.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2025-02-09'
  },
  {
    id: 'x402',
    title: 'x402 ‚Äî Internet-Native Payments for Agents',
    icon: 'üí≥',
    desc: 'Coinbase‚Äôs open standard for pay-per-request HTTP payments. Agents can autonomously buy APIs/data with 402 + crypto.',
    tags: ['AI Infrastructure', 'Crypto', 'Payments'],
    url: 'ai-value-chain/x402-agentic-payments.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2026-02-04'
  },
  {
    id: 'si-photonics',
    title: 'Silicon Photonics',
    icon: 'üí°',
    desc: 'Light-based data transfer on silicon ‚Äî the emerging technology connecting chips at the speed of light.',
    tags: ['Emerging Tech', 'Deep Dive'],
    url: 'ai-value-chain/silicon-photonics.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2025-02-10'
  },
  {
    id: 'si-photonics-2',
    title: 'Silicon Photonics II: CMOS Leverage',
    icon: 'üî¨',
    desc: 'How old fabs become gold mines ‚Äî materials, lithography, design tools & the economic moat.',
    tags: ['Semiconductors', 'Emerging Tech'],
    url: 'ai-value-chain/silicon-photonics-2.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2025-02-11'
  },
  {
    id: 'ocs',
    title: 'Optical Circuit Switching (OCS)',
    icon: 'üîÄ',
    desc: 'Layer 1 optical switching ‚Äî reroutes light without O-E-O conversion. Google Apollo: +30% throughput, -40% power. The switching layer that makes photonic interconnects work at scale.',
    tags: ['Emerging Tech', 'Deep Dive', 'AI Infrastructure'],
    url: 'ai-value-chain/optical-circuit-switching.html',
    category: 'AI & Semiconductor Value Chain',
    categoryIcon: 'ü§ñ',
    section: 'hanif',
    date: '2026-02-04'
  },
  // --- Hanif: Investing ---
  {
    id: 'strava-unit-econ',
    title: 'Strava ‚Äî Unit Economics Breakdown',
    icon: 'üèÉ',
    desc: "Deep dive into Strava's business model, subscriber economics, and path to profitability.",
    tags: ['Finance', 'Case Study'],
    url: 'investing/strava-unit-economics.html',
    category: 'Entrepreneurial Finance',
    categoryIcon: 'üí∞',
    section: 'sasya',
    date: '2025-03-01'
  },
  {
    id: 'pain-reflection',
    title: 'Pain + Reflection = Progress',
    icon: 'üî•',
    desc: 'Lessons from a 6-sigma silver crash ‚Äî short gamma mechanics, China premium, and money wisdom from @abcampbell.',
    tags: ['Investing', 'Deep Dive'],
    url: 'investing/pain-reflection-progress.html',
    category: 'Investing & Markets',
    categoryIcon: 'üí∞',
    section: 'hanif',
    date: '2026-02-02'
  },
  {
    id: 'indonesia-gold-industry',
    title: "Indonesia's Gold Industry: From Mine to Market",
    icon: 'ü™ô',
    desc: 'Value chain map, IDX gold emitens, and technical/regulatory deep dive on Indonesia\'s gold ecosystem.',
    tags: ['Investing', 'Deep Dive', 'Commodities'],
    url: 'investing/indonesia-gold-industry.html',
    category: 'Investing & Markets',
    categoryIcon: 'üí∞',
    section: 'hanif',
    date: '2026-02-04'
  },
  {
    id: 'uranium-nuclear-energy',
    title: 'Uranium & Nuclear Energy',
    icon: '‚ò¢Ô∏è',
    desc: 'AI data centers need 24/7 baseload power. Nuclear is back, uranium supply is tight, and the whole chain is a bottleneck play.',
    tags: ['Investing', 'Deep Dive', 'Energy', 'Commodities'],
    url: 'investing/uranium-nuclear-energy.html',
    category: 'Investing & Markets',
    categoryIcon: 'üí∞',
    section: 'hanif',
    date: '2026-02-04'
  },
  // --- Company Deep Dives ---
  {
    id: 'micron-mu',
    title: 'Micron (MU) ‚Äî Deep Dive',
    icon: 'üíæ',
    desc: 'Memory supercycle leader. HBM sold out through 2026, record margins, ~13x forward P/E. Best risk/reward in storage.',
    tags: ['Investing', 'Deep Dive', 'Memory', 'Semiconductors'],
    url: 'investing/company-deep-dives/micron-mu.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-03'
  },
  {
    id: 'sandisk-sndk',
    title: 'SanDisk (SNDK) ‚Äî Deep Dive',
    icon: 'üíø',
    desc: 'Pure-play NAND. Up 700% since spinoff, Q3 guide at 65%+ margins. Great cycle, stretched price ‚Äî wait for pullback.',
    tags: ['Investing', 'Deep Dive', 'Memory', 'Storage'],
    url: 'investing/company-deep-dives/sandisk-sndk.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-03'
  },
  {
    id: 'seagate-stx',
    title: 'Seagate (STX) ‚Äî Deep Dive',
    icon: 'üóÑÔ∏è',
    desc: 'HDD duopoly with HAMR tech lead. Record margins, sold out through 2026. Don\'t chase at $444 ‚Äî wait for $320-350.',
    tags: ['Investing', 'Deep Dive', 'Storage', 'HDD'],
    url: 'investing/company-deep-dives/seagate-stx.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-03'
  },
  {
    id: 'lumentum-lite',
    title: 'Lumentum (LITE) ‚Äî Deep Dive',
    icon: 'üî¶',
    desc: 'AI optical infrastructure leader. 50‚Äì60% EML share, revenue doubling, optics transition tailwind.',
    tags: ['Investing', 'Deep Dive', 'Optical', 'AI Infrastructure'],
    url: 'investing/company-deep-dives/lumentum-lite.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-04'
  },
  {
    id: 'intel-intc',
    title: 'Intel (INTC) ‚Äî Deep Dive',
    icon: 'üè≠',
    desc: 'Speculative turnaround. 18A in production, Microsoft foundry deal rumored. At $49, paying for faith not fundamentals.',
    tags: ['Investing', 'Deep Dive', 'Foundry', 'Semiconductors'],
    url: 'investing/company-deep-dives/intel-intc.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-03'
  },
  // --- Indonesian Equity Deep Dives ---
  {
    id: 'adro-alamtri',
    title: 'Alamtri Resources (ADRO) ‚Äî Deep Dive',
    icon: 'üèóÔ∏è',
    desc: 'Post spin-off holdco. 83.8% ADMR + Adaro Green (1,375 MW hydro). Sum-of-parts play at holdco discount.',
    tags: ['Investing', 'Deep Dive', 'Indonesia', 'Holdco', 'Energy'],
    url: 'investing/company-deep-dives/adro-alamtri.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-04'
  },
  {
    id: 'aadi-adaro-andalan',
    title: 'Adaro Andalan (AADI) ‚Äî Deep Dive',
    icon: '‚õèÔ∏è',
    desc: 'Pure thermal coal. $3.6B rev, 52.69M tons sold, >10% div yield. Spun off from ADRO ‚Äî high yield cash cow.',
    tags: ['Investing', 'Deep Dive', 'Indonesia', 'Coal', 'Dividend'],
    url: 'investing/company-deep-dives/aadi-adaro-andalan.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-04'
  },
  {
    id: 'admr-adaro-minerals',
    title: 'Adaro Minerals (ADMR) ‚Äî Deep Dive',
    icon: 'üî©',
    desc: 'Met coal + aluminium smelter. Rp11.26T rev, 30% production surge. Green aluminium thesis via hydro power.',
    tags: ['Investing', 'Deep Dive', 'Indonesia', 'Coal', 'Aluminium'],
    url: 'investing/company-deep-dives/admr-adaro-minerals.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-04'
  },
  {
    id: 'srtg-saratoga',
    title: 'Saratoga Investama (SRTG) ‚Äî Deep Dive',
    icon: 'üè¶',
    desc: 'Indonesia\'s premier listed PE holdco. NAV Rp53.9T, 40-60% discount. Portfolio: ADRO, TBIG, MDKA, MPMX.',
    tags: ['Investing', 'Deep Dive', 'Indonesia', 'Holdco'],
    url: 'investing/company-deep-dives/srtg-saratoga.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-04'
  },
  {
    id: 'mdka-merdeka',
    title: 'Merdeka Copper Gold (MDKA) ‚Äî Deep Dive',
    icon: 'ü•á',
    desc: 'Multi-commodity: gold, copper, nickel. 103k‚Üí205k oz gold target 2026. Pani Gold transformational via EMAS.',
    tags: ['Investing', 'Deep Dive', 'Indonesia', 'Gold', 'Mining'],
    url: 'investing/company-deep-dives/mdka-merdeka.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-04'
  },
  {
    id: 'medc-medco',
    title: 'Medco Energi (MEDC) ‚Äî Deep Dive',
    icon: '‚õΩ',
    desc: 'Integrated energy: O&G + power + 20.9% AMMN. Record 170k mboepd target. Gas-heavy (70%), renewables expanding.',
    tags: ['Investing', 'Deep Dive', 'Indonesia', 'Oil & Gas', 'Energy'],
    url: 'investing/company-deep-dives/medc-medco.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-04'
  },
  {
    id: 'emas-merdeka-gold',
    title: 'Merdeka Gold (EMAS) ‚Äî Deep Dive',
    icon: 'ü™ô',
    desc: 'Pre-production gold. Pani Project: first gold Q1 2026, 79k‚Üí500k oz by 2032. Pure optionality on Indonesia\'s largest undeveloped gold deposit.',
    tags: ['Investing', 'Deep Dive', 'Indonesia', 'Gold', 'Pre-Revenue'],
    url: 'investing/company-deep-dives/emas-merdeka-gold.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-04'
  },
  {
    id: 'elsa-elnusa',
    title: 'Elnusa (ELSA) ‚Äî Deep Dive',
    icon: 'üõ¢Ô∏è',
    desc: 'Pertamina subsidiary. O&G services across upstream, distribution, support. Rp10.48T rev. Defensive stable income play.',
    tags: ['Investing', 'Deep Dive', 'Indonesia', 'Oil & Gas', 'Services'],
    url: 'investing/company-deep-dives/elsa-elnusa.html',
    category: 'Company Deep Dives',
    categoryIcon: 'üîç',
    section: 'hanif',
    date: '2026-02-04'
  },
  {
    id: 'llms-vs-marketplaces',
    title: 'LLMs vs Marketplaces: Who Gets Disrupted?',
    icon: 'ü§ñ',
    desc: 'Framework for predicting which marketplaces survive AI agents. Supply aggregation, management depth, and customer engagement determine defensibility.',
    tags: ['Investing', 'Framework', 'AI'],
    url: 'investing/llms-vs-marketplaces.html',
    category: 'Investing & Markets',
    categoryIcon: 'üí∞',
    section: 'hanif',
    date: '2026-02-06'
  },
  {
    id: 'us-china-convergence',
    title: 'US-China Convergence: The Superpower Trade',
    icon: 'üåè',
    desc: 'Why US and China will become more like each other ‚Äî and why that favors Chinese equities. RMB undervaluation, "Amazon at national scale," and the 5x valuation gap.',
    tags: ['Investing', 'Framework', 'Macro', 'China'],
    url: 'investing/us-china-convergence.html',
    category: 'Investing & Markets',
    categoryIcon: 'üí∞',
    section: 'hanif',
    date: '2026-02-11'
  }
];

// ============================================================
// STATE
// ============================================================
let currentSection = 'sasya';
let activeTags = new Set();
let favorites = new Set(JSON.parse(localStorage.getItem('studyhub-favs') || '[]'));
let readPages = new Set(JSON.parse(localStorage.getItem('studyhub-read') || '[]'));
let unreadOnly = false;
let searchQuery = '';
let sortMode = 'recent';

// ============================================================
// FUZZY SEARCH (using Fuse.js)
// ============================================================
let fuse = null;

function initFuse() {
  const options = {
    keys: [
      { name: 'title', weight: 0.4 },
      { name: 'desc', weight: 0.2 },
      { name: 'category', weight: 0.2 },
      { name: 'tags', weight: 0.2 }
    ],
    threshold: 0.4,
    ignoreLocation: true,
    includeScore: true,
    minMatchCharLength: 2
  };
  fuse = new Fuse(PAGES, options);
}

function matchesSearch(page) {
  if (!searchQuery) return true;
  const q = searchQuery.trim();
  if (!q) return true;
  
  // Use Fuse.js if available, fallback to simple match
  if (fuse) {
    const results = fuse.search(q);
    return results.some(r => r.item.id === page.id);
  }
  
  // Fallback: simple fuzzy match
  const haystack = [page.title, page.desc, page.category, ...page.tags].join(' ').toLowerCase();
  const query = q.toLowerCase();
  if (haystack.includes(query)) return true;
  // subsequence match
  let qi = 0;
  for (let i = 0; i < haystack.length && qi < query.length; i++) {
    if (haystack[i] === query[qi]) qi++;
  }
  return qi === query.length;
}

function matchesTags(page) {
  if (activeTags.size === 0) return true;
  for (const t of activeTags) {
    if (!page.tags.some(pt => pt.toLowerCase() === t.toLowerCase())) return false;
  }
  return true;
}

// ============================================================
// RENDER
// ============================================================
function getFilteredPages() {
  return PAGES.filter(p =>
    p.section === currentSection &&
    matchesSearch(p) &&
    matchesTags(p) &&
    (!unreadOnly || !readPages.has(p.id))
  );
}

function sortPages(pages) {
  const arr = [...pages];
  switch (sortMode) {
    case 'alpha':
      arr.sort((a, b) => a.title.localeCompare(b.title));
      break;
    case 'category':
      arr.sort((a, b) => a.category.localeCompare(b.category) || a.title.localeCompare(b.title));
      break;
    case 'unread':
      arr.sort((a, b) => {
        const aUnread = readPages.has(a.id) ? 1 : 0;
        const bUnread = readPages.has(b.id) ? 1 : 0;
        if (aUnread !== bUnread) return aUnread - bUnread;
        return b.date.localeCompare(a.date);
      });
      break;
    case 'recent':
    default:
      arr.sort((a, b) => b.date.localeCompare(a.date));
      break;
  }
  return arr;
}

function renderCard(page, isFav) {
  const starred = favorites.has(page.id);
  const isRead = readPages.has(page.id);
  const unreadDot = isRead ? '' : '<span class="unread-dot" title="Unread"></span>';
  return `
    <div class="card" style="cursor:pointer;" onclick="if(!event.target.closest('.star-btn')){markRead('${page.id}');window.location.href='${page.url}';}">
      <button class="star-btn ${starred ? 'starred' : ''}" onclick="event.stopPropagation();toggleFav('${page.id}')" title="${starred ? 'Remove from favorites' : 'Add to favorites'}">
        ${starred ? '‚òÖ' : '‚òÜ'}
      </button>
      <div class="card-title">
        ${unreadDot}<span class="icon">${page.icon}</span> ${page.title}
      </div>
      <div class="card-desc">${page.desc}</div>
      <div class="tags">${page.tags.map(t => `<span class="tag">${t}</span>`).join('')}</div>
    </div>
  `;
}

function render() {
  updateCounts();
  const filtered = getFilteredPages();
  const sorted = sortPages(filtered);
  const area = document.getElementById('content-area');
  const noResults = document.getElementById('no-results');

  // Favorites for current section
  const favPages = PAGES.filter(p =>
    p.section === currentSection &&
    favorites.has(p.id) &&
    matchesSearch(p) &&
    matchesTags(p) &&
    (!unreadOnly || !readPages.has(p.id))
  );
  const favSection = document.getElementById('favorites-section');
  const favCards = document.getElementById('favorites-cards');
  if (favPages.length > 0) {
    favSection.classList.add('visible');
    favCards.innerHTML = sortPages(favPages).map(p => renderCard(p, true)).join('');
  } else {
    favSection.classList.remove('visible');
    favCards.innerHTML = '';
  }

  if (sorted.length === 0) {
    area.innerHTML = '';
    noResults.style.display = 'block';
    return;
  }
  noResults.style.display = 'none';

  // Group by category
  const groups = new Map();
  for (const p of sorted) {
    if (!groups.has(p.category)) {
      groups.set(p.category, { icon: p.categoryIcon, pages: [] });
    }
    groups.get(p.category).pages.push(p);
  }

  let html = '';
  for (const [cat, data] of groups) {
    const groupId = cat.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
    const collapsed = localStorage.getItem('collapse-' + groupId) === '1';
    html += `
      <div class="course-group ${collapsed ? 'collapsed' : ''}" data-group="${groupId}">
        <div class="course-group-header" onclick="toggleGroup('${groupId}')">
          <span class="course-group-title">${data.icon} ${cat}</span>
          <span class="group-count">${data.pages.length}</span>
          <span class="group-chevron">‚ñº</span>
        </div>
        <div class="group-cards">
          ${data.pages.map(p => renderCard(p, false)).join('')}
        </div>
      </div>
    `;
  }

  // Add empty categories for Sasya
  if (currentSection === 'sasya') {
    const sasyaCategories = ['Dissertation (MG4J5)'];
    const sasyaIcons = ['üìñ'];
    const existingCats = new Set(groups.keys());
    sasyaCategories.forEach((cat, i) => {
      if (!existingCats.has(cat) && !searchQuery && activeTags.size === 0) {
        html += `
          <div class="course-group">
            <div class="course-group-header">
              <span class="course-group-title">${sasyaIcons[i]} ${cat}</span>
              <span class="group-count">0</span>
            </div>
            <div class="group-cards">
              <div class="empty"><div class="emoji">üìù</div>Materials coming soon</div>
            </div>
          </div>
        `;
      }
    });
  }

  // Add empty categories for Hanif
  if (currentSection === 'hanif') {
    const hanifEmpty = [{ name: 'Cambridge MBA Prep', icon: 'üéì' }];
    const existingCats = new Set(groups.keys());
    hanifEmpty.forEach(cat => {
      if (!existingCats.has(cat.name) && !searchQuery && activeTags.size === 0) {
        html += `
          <div class="course-group">
            <div class="course-group-header">
              <span class="course-group-title">${cat.icon} ${cat.name}</span>
              <span class="group-count">0</span>
            </div>
            <div class="group-cards">
              <div class="empty"><div class="emoji">üìù</div>Materials coming soon</div>
            </div>
          </div>
        `;
      }
    });
  }

  area.innerHTML = html;
}

// ============================================================
// TAG FILTERS
// ============================================================
function buildTagFilters() {
  const allTags = new Set();
  PAGES.forEach(p => p.tags.forEach(t => allTags.add(t)));
  const sorted = [...allTags].sort();
  const menu = document.getElementById('tag-select-menu');
  if (menu) {
    menu.innerHTML = sorted.map(t => {
      const checked = activeTags.has(t) ? 'checked' : '';
      return `
        <label class="tag-option">
          <input type="checkbox" value="${t}" ${checked} onchange="toggleTag('${t.replace(/'/g, "\\'")}')">
          <span>${t}</span>
        </label>
      `;
    }).join('');
  }
  updateTagSelectLabel();
  renderTagChips();
  syncUnreadToggle();
}

function updateTagSelectLabel() {
  const label = document.getElementById('tag-select-label');
  const trigger = document.getElementById('tag-select-trigger');
  if (!label || !trigger) return;
  if (activeTags.size === 0) {
    label.textContent = 'Filter by tag...';
    trigger.classList.remove('active');
  } else {
    label.textContent = `Tags (${activeTags.size})`;
    trigger.classList.add('active');
  }
}

function renderTagChips() {
  const chips = document.getElementById('tag-chips');
  if (!chips) return;
  if (activeTags.size === 0) {
    chips.innerHTML = '';
    return;
  }
  chips.innerHTML = [...activeTags].sort().map(tag => `
    <span class="tag-chip">
      ${tag}
      <button type="button" aria-label="Remove ${tag}" onclick="toggleTag('${tag.replace(/'/g, "\\'")}')">√ó</button>
    </span>
  `).join('');
}

function toggleTag(tag) {
  if (activeTags.has(tag)) activeTags.delete(tag);
  else activeTags.add(tag);
  buildTagFilters();
  render();
}

function syncUnreadToggle() {
  const checkbox = document.getElementById('unread-toggle');
  const label = document.getElementById('unread-toggle-label');
  if (!checkbox || !label) return;
  checkbox.checked = unreadOnly;
  label.classList.toggle('active', unreadOnly);
}

function toggleUnreadOnly() {
  unreadOnly = !unreadOnly;
  syncUnreadToggle();
  render();
}

// ============================================================
// ACTIONS
// ============================================================
function saveReadState() {
  localStorage.setItem('studyhub-read', JSON.stringify([...readPages]));
}

function updateCounts() {
  const total = PAGES.length;
  const readCount = PAGES.filter(p => readPages.has(p.id)).length;
  const unreadCount = total - readCount;
  document.getElementById('page-count').textContent = total;
  document.getElementById('unread-count').textContent = unreadCount;
}

function markRead(pageId) {
  if (!readPages.has(pageId)) {
    readPages.add(pageId);
    saveReadState();
    updateCounts();
    render();
  }
}

function markAllRead() {
  readPages = new Set(PAGES.map(p => p.id));
  saveReadState();
  updateCounts();
  render();
}

function resetRead() {
  readPages = new Set();
  saveReadState();
  updateCounts();
  render();
}

function switchTab(section, btn) {
  currentSection = section;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  render();
}

function toggleGroup(groupId) {
  const el = document.querySelector(`[data-group="${groupId}"]`);
  if (!el) return;
  el.classList.toggle('collapsed');
  localStorage.setItem('collapse-' + groupId, el.classList.contains('collapsed') ? '1' : '0');
}

function toggleFav(pageId) {
  if (favorites.has(pageId)) favorites.delete(pageId);
  else favorites.add(pageId);
  localStorage.setItem('studyhub-favs', JSON.stringify([...favorites]));
  render();
}

function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  document.getElementById('theme-icon').textContent = next === 'dark' ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('theme', next);
}

// ============================================================
// INIT
// ============================================================
(function() {
  // Restore theme (default to light)
  const saved = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', saved);
  document.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.getElementById('theme-icon').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

    // Update page count
    updateCounts();

    // Initialize Fuse.js for fuzzy search
    initFuse();

    // Search
    const searchInput = document.getElementById('search-input');
    searchInput.addEventListener('input', function() {
      searchQuery = this.value;
      render();
    });

    // Keyboard shortcuts: / to focus search, Esc to clear
    document.addEventListener('keydown', function(e) {
      // / to focus search (when not already in an input)
      if (e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
        e.preventDefault();
        searchInput.focus();
      }
      // Esc to clear search and blur
      if (e.key === 'Escape' && document.activeElement === searchInput) {
        searchInput.value = '';
        searchQuery = '';
        searchInput.blur();
        render();
      }
    });

    // Sort
    document.getElementById('sort-select').addEventListener('change', function() {
      sortMode = this.value;
      render();
    });

    // Tag dropdown
    const tagSelect = document.getElementById('tag-select');
    const tagTrigger = document.getElementById('tag-select-trigger');
    const unreadToggle = document.getElementById('unread-toggle');

    if (tagTrigger && tagSelect) {
      tagTrigger.addEventListener('click', function(event) {
        event.stopPropagation();
        const isOpen = tagSelect.classList.toggle('open');
        tagTrigger.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
      });

      document.addEventListener('click', function(event) {
        if (!tagSelect.contains(event.target)) {
          tagSelect.classList.remove('open');
          tagTrigger.setAttribute('aria-expanded', 'false');
        }
      });
    }

    if (unreadToggle) {
      unreadToggle.addEventListener('change', function() {
        unreadOnly = this.checked;
        syncUnreadToggle();
        render();
      });
    }

    buildTagFilters();
    render();
  });
})();
</script>

</body>
</html>
